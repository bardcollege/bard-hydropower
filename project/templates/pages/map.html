{% extends 'layouts/leaflet.html' %} {% block title %}Hydro Power Calculator{% endblock %} {% block content %}

<!--div id="loading">
		<div class="progress">
		  <div class="progress-bar progress-bar-success" style="width: 40%">
			<span class="sr-only">35% Complete (success)</span>
			Watershed: Complete
		  </div>
		  <div class="progress-bar progress-bar-info progress-bar-striped" style="width: 40%">
			<span class="sr-only">20% Complete (warning)</span>
			Elevation Profile: in progress
		  </div>
		  <div class="progress-bar progress-bar-warning" style="width: 20%">
			<span class="sr-only">10% Complete (danger)</span>
			Suitability: waiting
		  </div>
		</div>
	</div-->

<div class="modal" id="aboutModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3 class="modal-title">Bard Microhydropower Calculator</h3>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs nav-justified" id="aboutTabs">
                    <li class="active">
                        <a href="#about" data-toggle="tab">
                            <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> About</a>
                    </li>
                    <li>
                        <a href="#help" data-toggle="tab">
                            <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span> Help</a>
                    </li>
                    <li>
                        <a href="#methods" data-toggle="tab">
                            <span class="glyphicon glyphicon-book" aria-hidden="true"></span> How It Works</a>
                    </li>

                </ul>
                <div class="tab-content" id="aboutTabsContent">
                    <div id="about" class="tab-pane active in">
                        <p>About the project, terms of use, etc</p>
                    </div>
                    <div id="help" class="tab-pane">
                        <p>How to use the tool</p>
                    </div>
                    <div id="methods" class="tab-pane">
                        <p>How the tools works</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div id="container">

    <div id="sidebar">
        <div class="sidebar-wrapper">

            <!--TABS-->
            <ul class="nav nav-tabs nav-justified" id="stepControl">
                <li class="active">
                    <a id="tabStep0" href="#step0" data-toggle="tab">Overview</a>
                </li>
                <li>
                    <a id="tabStep1" href="#step1" data-toggle="tab">1. Site</a>
                </li>
                <li>
                    <a id="tabStep2" href="#step2" data-toggle="tab">2. Parameters</a>
                </li>
                <li>
                    <a id="tabStep3" href="#step3" data-toggle="tab">3. Results</a>
                </li>
            </ul>

            <!--TAB CONTENT-->
            <div class="tab-content" id="aboutTabsContent">

                <div id="step0" class="tab-pane active in">
                    <!--<div id="step0" class="tab-pane">-->
                    <div class="row">
                        <div class="col-sm-12">
                            <h4>Estimate the power generation potential of a micro-hydroelectric turbine installation.</h4>
                            <h4><small>This calculator will guide you through these steps:</small></h4>
                            <ol>
                                <li><strong>Site Sketch.</strong> Use the map to identify and sketch a potential micro-hydro location. The calculator will automatically generate an elevation profile, estimate head, and delineate the contributing area using
                                    available topographic data.</li>
                                <li><strong>Parameters.</strong> Input calculation coefficients and other assumptions; sensible defaults are provided. Optionally, override the head and area estimates provided in step 1 as needed.</li>
                                <li><strong>Results.</strong> View the analysis results.</li>
                            </ol>
                            <hr>
                            <a id="btn-getStarted" class="btn btn-default btn-block btn-lg btn-goToDrawing" role="button" href="#step1">Get Started <i class="fa fa-arrow-circle-right"></i></a>
                        </div>
                    </div>
                </div>

                <div id="step1" class="tab-pane">
                    <div class="row">
                        <div class="col-sm-12">
                            <h4>First, find a location for a potential micro-hydro installation.</h4>
                            <p>Use the map to the left and the available layers to find locations suitable for microhydro installation. Streams and weir locations are shown to help; switch the basemap from imagery to terrain to get a better sense of the
                                topography.
                            </p>
                            <hr>
                            <h4>Then, sketch a conceptual installation.</h4>
                            <p class="small"><span class="leaflet-draw-toolbar leaflet-bar help-draw-icon"><a disabled class="leaflet-draw-draw-polyline" href="#" title="Draw a line."></a></span> Use the draw tool to draw a line from a point downstream (lower elevation)
                                to a point upstream (higher elevation) to indicate the potential location of a micro-hydro installation.
                                <p class="small"><span class="leaflet-draw-toolbar leaflet-bar help-draw-icon"><a disabled class="leaflet-draw-edit-edit" href="#" title="Edit layers."></a></span> Use the edit button to modify your sketch.
                                </p>
                                <p class="small"><span class="leaflet-draw-toolbar leaflet-bar help-draw-icon"><a disabled class="leaflet-draw-edit-remove" href="#" title="Delete layers."></a></span> Use the delete button to delete your sketch.
                                </p>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-12">
                            <div id="site-tab-results">
                                <h4>From the map:</h4>
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <h3 class="panel-title">Head <span class="gp-msg gp-msg-head well"><small>Calculating...</small><i class="fa fa-spinner fa-pulse fa-fw"></i><span class="sr-only">Estimating Head...</span></span>
                                                </h3>
                                            </div>
                                            <div class="panel-body">
                                                <h4><span class="results-head">0</span> <small>Feet</small></h3>
                                                    <!--<div id="profile-viz" class="well">>>> interactive elevation profile visualization here <<<</div>-->
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <h3 class="panel-title">Area <span class="gp-msg gp-msg-area well"><small>Calculating...</small><i class="fa fa-spinner fa-pulse fa-fw"></i><span class="sr-only">Delineating Area...</span></span>
                                                </h3>
                                            </div>
                                            <div class="panel-body">
                                                <h4><span class="results-area">0</span> <small>Acres</small></h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <a class="btn btn-default btn-block btn-goToParams" role="button" href="#step2">Adjust Parameters <i class="fa fa-arrow-circle-right"></i></a>
                        </div>
                    </div>
                </div>

                <div id="step2" class="tab-pane">
                    <div class="row">
                        <div class="col-sm-12">
                            <form class="form-horizontal">
                                <!-- HEAD & AREA -->
                                <div class="row">
                                    <div class="col-sm-3">
                                        <h4>Head & Area</h4>
                                    </div>
                                    <div class="col-sm-9">
                                        <p class="small param-instructions">Optionally, manually enter the Head and/or Area here; indicate with the switch whether you want to use the value from the map or the one you've provided for the calculation.</p>
                                    </div>
                                </div>

                                <br>

                                <div class="form-group has-feedback">
                                    <label class="control-label col-sm-2" for="head-form-field">Head</label>
                                    <div class="col-sm-3">
                                        <input id="head-form-check" type="checkbox" data-on="Form" data-off="Map" class="switch params-head" data-toggle="toggle">
                                    </div>
                                    <div class="col-sm-7">
                                        <div class="input-group">
                                            <input disabled id="head-form-field" type="text" class="form-control params params-head" aria-describedby="head-form-units" placeholder="Sketch a microhydro installation on the map to derive this parameter">
                                            <span id="gp-msg-head" class="gp-msg gp-msg-head fa fa-2x fa-cog fa-spin fa-fw form-control-feedback"></span>
                                            <span class="input-group-addon" id="head-form-units"><small>Feet</small></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group has-feedback">
                                    <label class="control-label col-sm-2" for="area-form-field">Area</label>
                                    <div class="col-sm-3">
                                        <input id="area-form-check" type="checkbox" data-on="Form" data-off="Map" class="switch params-area" data-toggle="toggle">
                                    </div>
                                    <div class="col-sm-7">
                                        <div class="input-group">
                                            <input disabled id="area-form-field" type="text" class="form-control params params-area" aria-describedby="area-form-units" placeholder="Sketch a microhydro installation on the map to derive this parameter">
                                            <span id="gp-msg-area" class="gp-msg gp-msg-area fa fa-2x fa-cog fa-spin fa-fw form-control-feedback"></span>
                                            <span class="input-group-addon" id="area-form-units"><small>Acres</small></span>
                                        </div>
                                    </div>
                                </div>

                                <hr>

                                <!-- CONSTANTS  -->
                                <div class="row">
                                    <div class="col-sm-3">
                                        <h4>Constants</h4>
                                    </div>
                                    <div class="col-sm-9">
                                        <p class="small param-instructions">Adjust the parameters below, or leave at provided defaults.</p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-sm-6" for="eff-form-field">Efficiency</label>
                                            <div class="col-sm-6">
                                                <input id="eff-form-field" type="text" class="form-control params params-effy" aria-describedby="eff-form-units" placeholder="default: 0.7" value=0.7>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <input id="eff-param-slider" class="param-slider params" data-slider-id='eff-form-field' type="text" data-slider-min="0" data-slider-max="1" data-slider-step="0.01" data-slider-value="0.7" />
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-sm-6" for="env-form-field">Environmental Flow</label>
                                            <div class="col-sm-6">
                                                <input id="env-form-field" type="text" class="form-control params params-envn" aria-describedby="env-form-units" placeholder="default: 0.3" value=0.3>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <input id="env-param-slider" class="param-slider params" data-slider-id='env-form-field' type="text" data-slider-min="0" data-slider-max="0.5" data-slider-step="0.01" data-slider-value="0.3" />
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label class="control-label col-sm-3" for="rate-form-field">Cost/KwH</label>
                                            <div class="col-sm-9">
                                                <div class="input-group">
                                                    <span class="input-group-addon" id="rate-form-units"><small>$</small></span>
                                                    <input id="rate-form-field" type="text" class="form-control params params-rate" aria-describedby="rate-form-units" placeholder="default: 0.10" value=0.10>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </form>
                        </div>
                    </div>

                    <hr>

                    <!-- CALCULATE BUTTON -->
                    <div class="row">
                        <div class="col-sm-12">
                            <span id="params-msg-status"></span>
                            <button id="params-analyze-btn" class="btn btn-primary btn-block btn-lg analyze-btn" type="submit">Calculate</button>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-sm-12">
                            <span id="params-notification"></span>
                        </div>
                    </div>
                </div>

                <!-- RESULTS TAB -->
                <div id="step3" class="tab-pane">

                    <div class="row">
                        <div class="col-sm-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h2 class="panel-title">Power Potential</h2>
                                </div>
                                <div class="panel-body">
                                    <h1><span class="results-powr results"></span> <small>kilowatt hours</small></h1>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h2 class="panel-title">Value</h2>
                                </div>
                                <div class="panel-body">
                                    <h1>$<span class="results-cost results"></span> <small>/ year</small></h1>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-7">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Head</h3>
                                </div>
                                <div class="panel-body">
                                    <h2>
                                        <span class="results-head"></span> <small>Feet</small>
                                        <!--<div id="profile-viz" class="well">>>> interactive elevation profile visualization here <<<</div>-->
                                    </h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Contributing Area</h3>
                                </div>
                                <div class="panel-body">
                                    <h2><span class="results-area"></span> <small>Acres</small></h2>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12">
                            <div class="panel panel-default">
                                <!-- Default panel contents -->
                                <div class="panel-heading">
                                    <h4 class="panel-title">Constants</h4>
                                </div>
                                <ul class="list-group">
                                    <li class="list-group-item">Environmental Flow: <span class="results-envn results"></span> cubic meters per second</li>
                                    <li class="list-group-item">Efficiency: <span class="results-effy results"></span> %</li>
                                    <li class="list-group-item">Rate: $<span class="results-rate results"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="row">
                        <div class="col-sm-7">
                            <button class="btn btn-primary btn-block btn-goToParams" type="submit">Adjust Parameters <i class="fa fa-cogs"></i></i></button>
                        </div>
                        <div class="col-sm-5">
                            <button id="reset-btn" class="btn btn-default btn-block reset-btn" type="submit">Start Over <i class="fa fa-rotate-left"></i></button>
                        </div>
                    </div>

                </div>

            </div>
            <!--TAB CONTENT-->

        </div>
        <!--SIDEBAR WRAPPER-->
    </div>
    <!--SIDEBAR-->

    <div id="map"></div>

</div>

<!--UI-->
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="{{ url_for('static', filename='libs/bootstrap-toggle/bootstrap-toggle.min.js') }}"></script>
<script src="{{ url_for('static', filename='libs/bootstrap-slider/bootstrap-slider.min.js') }}"></script>
<!--D3-->
<!-- <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script> -->
<!--LEAFLET-->
<script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet-src.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>
<!-- <script src="{{ url_for('static', filename='libs/leaflet.control.custom/Leaflet.Control.Custom.js') }}"></script> -->
<script src="{{ url_for('static', filename='libs/leaflet-basemaps/L.Control.Basemaps-min.js') }}"></script>
<!-- <script src="{{ url_for('static', filename='libs/leaflet-omnivore/leaflet-omnivore.min.js') }}"></script> -->
<!--ESRI-LEAFLET-->
<script src="https://unpkg.com/esri-leaflet@2.1.3"></script>
<!-- <script src="https://unpkg.com/esri-leaflet-vector@1.0.3"></script> -->
<script src="https://unpkg.com/esri-leaflet-gp@2.0.1"></script>
<!-- <script src="https://unpkg.com/esri-leaflet-gp@2.0.1"></script> -->
<script src="https://unpkg.com/esri-leaflet-geocoder@2.2.8"></script>


<!-- ESRI-LEAFLET-WEBMAP
	<script src="https://leaflet.github.io/Leaflet.label/leaflet.label.js"></script>
	<script src="https://cdn.rawgit.com/Leaflet/Leaflet.heat/gh-pages/dist/leaflet-heat.js"></script>
	<script src="https://cdn.jsdelivr.net/leaflet.esri.heatmap-feature-layer/2.0.0-beta.1/esri-leaflet-heatmap-feature-layer.js"></script>
	<script src="http://cdn.jsdelivr.net/leaflet.esri.renderers/2.0.2/esri-leaflet-renderers.js"></script>
	<script src="https://muxlab.github.io/Leaflet.VectorIcon/L.VectorIcon.js"></script>
	<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script>
	<script src="https://cdn.jsdelivr.net/leaflet.esri.webmap/0.4.0/esri-leaflet-webmap.js"></script>
	 -->

<!--APPLICATION-->
{{ JSGlue.include() }}
<script>
    // ArcGIS token passed from Flask to javascript (rendered by Jinja2)
    var tokens = JSON.parse('{{tokens | tojson}}');
    console.log(tokens);
    // geodata served from Flask's static files directory
    var geodata = {
        "nysdams": "{{ url_for('static', filename='assets/data/nysdams.geojson') }}"
    }
    console.log(geodata.nysdams);
</script>
{% assets "bundle_js" %}
<script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %}
<!--script type="text/javascript" src="/static/js/map.js" defer></script>
	<script type="text/javascript" src="/static/js/plugins.js" defer></script-->
{% endblock %}